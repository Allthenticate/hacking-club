from flask import Flask
from flask import render_template
from flask import request
import models as dbHandler

app = Flask(__name__)


@app.route("/", methods=["POST", "GET"])
def home():
    if request.method == "POST":
        username = request.form["username"]
        password = request.form["password"]
        dbHandler.insertUser(username, password)
        users = dbHandler.retrieveUsers()
        return render_template("index.html", users=users)
    else:
        return render_template("index.html")


@app.route("/login", methods=["POST"])
def login():
    username = request.form["username"]
    password = request.form["password"]
    try:
        if dbHandler.loginUser(username, password):
            return f"Welcome {username}!  You are logged in."
        else:
            return "I don't know you, get out of here."
    except Exception as e:
        return str(e)

@app.route("/search", methods=["GET"])
def search():
    username = request.args.get("username")
    try:
        users = dbHandler.searchUsers(username)
        return f"found {users}"

    except Exception as e:
        return str(e)

if __name__ == "__main__":
    app.run(debug=False, host="0.0.0.0", port=1337)
